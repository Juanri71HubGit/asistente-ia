<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Asistente Humana</title>
    <style>
        body { 
            margin: 0; 
            padding: 20px; 
            background: #0f172a; 
            color: white; 
            font-family: sans-serif; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            height: 100vh; 
            overflow: hidden;
        }
        
        /* Cambiado de cÃ­rculo a rectÃ¡ngulo vertical con esquinas redondeadas */
        .avatar { 
            width: 280px; 
            height: 450px; /* Altura mayor para formato vertical */
            border-radius: 30px; /* Esquinas redondeadas */
            border: 4px solid #38bdf8; 
            overflow: hidden; 
            margin-bottom: 20px; 
            box-shadow: 0 0 25px rgba(56, 189, 248, 0.4); 
            background: #000;
        }

        /* Ajuste para que el video no se recorte */
        video { 
            width: 100%; 
            height: 100%; 
            object-fit: contain; /* Cambiado de 'cover' a 'contain' para ver todo el video */
            background: black;
        }

        #btn-hablar { 
            padding: 18px 35px; 
            border-radius: 50px; 
            border: none; 
            background: #38bdf8; 
            color: white; 
            font-weight: bold; 
            font-size: 18px; 
            cursor: pointer; 
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(56, 189, 248, 0.3);
        }

        #btn-hablar:active {
            transform: scale(0.95);
        }

        #status { 
            margin-top: 15px; 
            color: #38bdf8; 
            font-style: italic; 
            text-align: center; 
            font-size: 0.9em;
            max-width: 80%;
        }
    </style>
</head>
<body>

    <div class="avatar">
        <video id="vid" autoplay loop muted playsinline>
            <source src="asistente.mp4" type="video/mp4">
        </video>
    </div>

    <div id="status">Lista para ayudarte</div>
    <br>
    <button id="btn-hablar">ðŸŽ¤ HABLAR CON ELLA</button>

    <script>
        const btn = document.getElementById('btn-hablar');
        const status = document.getElementById('status');
        const vid = document.getElementById('vid');
        const webhookURL = 'http://localhost:5678/webhook/alexandra';

        const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        recognition.lang = 'es-ES';

        btn.onclick = () => {
            recognition.start();
            status.innerText = "Escuchando...";
            btn.style.opacity = "0.5";
        };

        recognition.onresult = async (event) => {
            const texto = event.results[0][0].transcript;
            status.innerText = "TÃº: " + texto;
            btn.innerText = "Procesando...";

            try {
                const response = await fetch(webhookURL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text: texto })
                });

                if (response.ok) {
                    // Si el Webhook devuelve un archivo de audio directo
                    const audioBlob = await response.blob();
                    const audioUrl = URL.createObjectURL(audioBlob);
                    const audio = new Audio(audioUrl);
                    
                    status.innerText = "Alexandra respondiendo...";
                    
                    // PequeÃ±o truco visual: aumentar brillo del video cuando habla
                    vid.style.filter = "brightness(1.2)";
                    
                    audio.play();
                    
                    audio.onended = () => {
                        vid.style.filter = "brightness(1)";
                        status.innerText = "Lista para ayudarte";
                    };
                }
            } catch (e) {
                status.innerText = "Error de conexiÃ³n";
            } finally {
                btn.innerText = "ðŸŽ¤ HABLAR CON ELLA";
                btn.style.opacity = "1";
            }
        };
    </script>
</body>
</html>

